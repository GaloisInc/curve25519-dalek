# Inspired by worfklows in https://github.com/dalek-cryptography/curve25519-dalek/
name: CI

on:
  push:
  pull_request:

env:
  CARGO_TERM_COLOR: always

jobs:
  doc:
    name: Check docs
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: rustup default stable
      - run: cargo doc

  build:
    name: Build the code
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: rustup default stable
      - run: cargo build --all-targets

  test:
    name: Run tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: rustup default stable
      - run: cargo test

  prove:
    name: Run crux tests and proofs
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      - name: Check proofs
        run: |
          docker run -v $PWD:/work -w /work ghcr.io/galoisinc/crux-mir:nightly --lib -- -s z3
